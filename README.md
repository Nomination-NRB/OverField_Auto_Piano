# 🎹 Python 自动弹琴脚本

## 📖 功能介绍
本脚本由AI辅助编写，适用于 《开放空间》 Windows 平台，可以根据指定的乐谱文件，自动模拟键盘输入，在游戏中实现“自动弹琴”。
- **支持乐器**
  - 键盘

- **支持音域**  
  - 低音 1~7 → `asdfghj`  
  - 中音 1~7 → `qwertyu`  
  - 高音 1~7 → `1234567`  
  - 和弦（C, Dm, Em, F, G, Am, G7） → `zxcvbnm`  

- **可视化功能**  
  提供简单的窗口界面，可以选择乐谱文件并启动演奏。

- **自动演奏**  
  根据乐谱的时间轴，自动模拟键盘按键，实现自动弹奏。

- **MIDI音乐格式转换**  
  根据midi音乐文件自动转换为本程序支持的乐谱格式。
  

---

## 📂 文件结构
- `play_piano.py` → 主程序脚本  
- `twinkle_sample.lrcp` → 示例乐谱文件（《一闪一闪亮晶晶》）  
- `卡农.mid` → 示例mid文件（《卡农》）  
- `卡农.lrcp` → 示例乐谱文件（《卡农》）  
- `README.md` → 使用说明书  
- `README_Piano_Autoplayer_Tutorial.txt` → 乐谱编写教程  
- `midi2lrcp.py` → mid音乐文件转换工具  

---

## 📝 乐谱文件格式说明
乐谱文件采用类似 LRC 的格式，扩展名建议使用 `.lrcp`。

- **行格式：**
  ```
  [时间] 音符(可多个)
  ```

- **时间**：单位为秒，可以是小数，例如 `1.5`  
- **音符**：音名（低音、中音、高音、和弦），多个音符用空格隔开  
- **音符映射表**：  
  - 低音：`L1`~`L7`  
  - 中音：`M1`~`M7`  
  - 高音：`H1`~`H7`  
  - 和弦：`C, Dm, Em, F, G, Am, G7`  

### 示例：《一闪一闪亮晶晶》
```lrc
[00:00.000] M1 C
[00:00.600] M1
[00:01.199] M5
[00:01.799] M5
[00:02.399] M6
[00:03.000] M6
[00:03.600] M5
```

---

## ▶️ 使用方法
1. 安装依赖
   ```bash
   pip install pyautogui keyboard pretty_midi
   ```

2. 以**管理员权限**运行脚本（很重要，否则游戏可能不识别按键）：
   ```bash
   python play_piano.py
   ```

3. 在弹出的窗口中：
   - 点击“选择乐谱文件”，加载 `.lrcp` 乐谱  
   - 点击“开始演奏”即可自动弹奏

4. mid格式转换：
   - 在命令行中运行下列命令  
   ```bash
   python midi2lrcp.py <midi文件>
   ```
   - 在同级目录下生成 `.lrcp` 乐谱

---

## ⚠️ 注意事项
- **必须以管理员权限运行**（否则游戏可能无法识别输入）  
- 游戏可能带有反作弊机制，请谨慎使用  
- 如果遇到游戏无法识别输入，可以尝试：  
  1. 以管理员身份运行 Python  
  2. 切换到 `keyboard` 库方式  
  3. 使用虚拟键盘驱动（如 vJoy）

---

## 🎶 扩展建议
- 支持其他乐器：吉他、贝斯、架子鼓、麦克风
- 支持 MIDI 文件解析 → 自动转为 `.lrcp` 格式(已完成)
- 增加可视化钢琴键盘，实时显示按键情况  
- 支持录制功能，将实时演奏保存为 `.lrcp` 文件

---

## 📌 示例演奏
- 运行 `play_piano.py`  
- 选择 `twinkle_sample.lrcp`  
- 在游戏中即可听到《一闪一闪亮晶晶》自动演奏！
